<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creditreform News-Digest - {{ date }}</title>
  <!--[if mso]>
  <style type="text/css">
    table { border-collapse: collapse; }
    td { padding: 0; }
  </style>
  <![endif]-->
  <!--[if !mso]><!-->
  <style type="text/css">
    @media (prefers-color-scheme: dark) {
      .email-wrapper { background-color: #1a1a1a !important; }
      .content-container { background-color: #2d2d2d !important; }
      .section-summary { background-color: #1e3a5f !important; }
      .section-footer { background-color: #252525 !important; }
      .section-stats { background-color: #2a2a2a !important; }
      .text-body { color: #e0e0e0 !important; }
      .text-secondary { color: #cccccc !important; }
      .text-meta { color: #999999 !important; }
      .link-primary { color: #6699cc !important; }
      .border-section { border-color: #444444 !important; }
    }
  </style>
  <!--<![endif]-->
</head>
<body width="100%" class="email-wrapper" style="margin: 0; padding: 0; background-color: #f4f4f4; font-family: Arial, Helvetica, sans-serif; -webkit-font-smoothing: antialiased;" role="article" aria-label="Creditreform News-Digest">
  <table role="presentation" width="100%" cellspacing="0" cellpadding="0" class="email-wrapper" style="background-color: #f4f4f4;">
    <tr>
      <td align="center" style="padding: 20px 10px;">
        <!-- Main Container - 700px (industry standard for email) -->
        <table role="presentation" width="700" cellspacing="0" cellpadding="0" class="content-container" style="background-color: #ffffff; border-radius: 4px;">

          <!-- Header -->
          <tr>
            <td style="background-color: #003366; padding: 30px; border-radius: 4px 4px 0 0;">
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0">
                <tr>
                  <td>
                    <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: bold; letter-spacing: -0.5px;">
                      Creditreform
                    </h1>
                    <p style="margin: 4px 0 0 0; color: #a8c5e2; font-size: 14px; font-weight: normal; letter-spacing: 0.5px;">
                      Swiss Credit Risk Intelligence
                    </p>
                  </td>
                </tr>
                <tr>
                  <td style="padding-top: 16px; border-top: 1px solid #1a4d80;">
                    <p style="margin: 0; color: #ffffff; font-size: 16px; font-weight: bold;">
                      News-Digest
                    </p>
                    <p style="margin: 4px 0 0 0; color: #a8c5e2; font-size: 14px;">
                      {{ date }} &bull; {{ article_count }} relevante Artikel
                    </p>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          {% if executive_summary %}
          <!-- Executive Summary: Heute in 30 Sekunden -->
          <tr>
            <td class="section-summary" style="padding: 20px 30px; background-color: #f0f5fa; border-bottom: 2px solid #003366;">
              <h2 style="margin: 0 0 12px 0; color: #003366; font-size: 16px; font-weight: bold;">
                Heute in 30 Sekunden
              </h2>
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0">
                {% for sentence in executive_summary %}
                <tr>
                  <td class="text-body" style="padding: 4px 0; color: #333333; font-size: 14px; line-height: 1.5;">
                    <strong>{{ loop.index }}.</strong> {{ sentence }}
                  </td>
                </tr>
                {% endfor %}
              </table>
            </td>
          </tr>
          {% endif %}

          <!-- Articles by Topic - Single Column Layout (Outlook compatible) -->
          <tr>
            <td style="padding: 20px 30px;">
              {% if articles_by_topic %}
                {% for topic, topic_articles in articles_by_topic.items() %}
                <!-- Topic Header -->
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
                  <tr>
                    <td style="padding: 15px 0 10px 0; border-bottom: 2px solid #003366;">
                      <h2 style="margin: 0; color: #003366; font-size: 16px; font-weight: bold;">
                        {{ topic_translations.get(topic, topic) }}
                      </h2>
                    </td>
                  </tr>
                </table>

                <!-- Articles in single column with visual hierarchy -->
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
                  {% for article in topic_articles %}
                  <tr>
                    {% if article.risk_level == 'elevated' %}
                    <!-- Elevated Risk: Red left border, light red background -->
                    <td style="padding: 12px; margin: 8px 0; border-left: 4px solid #cc0000; background-color: #fff5f5; border-bottom: 1px solid #e0e0e0;">
                    {% else %}
                    <!-- Standard: Blue left border -->
                    <td style="padding: 12px; padding-left: 12px; border-left: 3px solid #003366; border-bottom: 1px solid #e0e0e0;">
                    {% endif %}
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0">
                        <tr>
                          {% if article.image_cid and images_enabled %}
                          <td width="100" valign="top" style="padding-right: 12px;">
                            <img src="cid:{{ article.image_cid }}" alt="" width="90" height="60" style="display: block; border-radius: 3px;" />
                          </td>
                          {% endif %}
                          <td valign="top">
                            {% if article.risk_level == 'elevated' %}
                            <p style="margin: 0 0 4px 0; font-size: 10px; font-weight: bold; color: #cc0000; text-transform: uppercase; letter-spacing: 0.5px;">&#9632; Erh√∂htes Risiko</p>
                            {% endif %}
                            <p style="margin: 0 0 4px 0; font-size: 14px; font-weight: bold; line-height: 1.3;">
                              {% if article.url %}<a href="{{ article.url }}" class="link-primary" style="color: {% if article.risk_level == 'elevated' %}#990000{% else %}#003366{% endif %}; text-decoration: none;">{{ article.title }}</a>{% else %}<span class="text-body">{{ article.title }}</span>{% endif %}
                            </p>
                            {% if article.companies %}
                            <p style="margin: 0 0 4px 0; color: #cc6600; font-size: 12px; font-weight: bold;">{{ article.companies[:3]|join(", ") }}</p>
                            {% endif %}
                            {% if article.all_sources and article.all_sources|length > 1 %}
                            <p class="text-meta" style="margin: 0 0 4px 0; color: #888888; font-size: 11px;">Quellen: {{ article.all_sources|join(", ") }}</p>
                            {% elif article.source %}
                            <p class="text-meta" style="margin: 0 0 4px 0; color: #888888; font-size: 11px;">{{ article.source }}</p>
                            {% endif %}
                            {% if article.summary %}
                            <p class="text-secondary" style="margin: 0 0 4px 0; color: #555555; font-size: 12px; line-height: 1.4;">{{ article.summary }}</p>
                            {% endif %}
                            {% if article.key_points %}
                            {% for point in article.key_points %}
                            <p class="text-secondary" style="margin: 0; color: #666666; font-size: 11px; line-height: 1.3;">&bull; {{ point }}</p>
                            {% endfor %}
                            {% endif %}
                            {% if article.relevance_keywords %}
                            <p style="margin: 6px 0 0 0; color: #006699; font-size: 11px; font-style: italic;">&rarr; Relevant: {{ article.relevance_keywords|join(", ") }}</p>
                            {% endif %}
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  {% endfor %}
                </table>
                {% endfor %}
              {% else %}
                <p class="text-secondary" style="color: #666666; font-size: 14px; font-style: italic;">Keine relevanten Artikel heute.</p>
              {% endif %}
            </td>
          </tr>

          <!-- Statistics -->
          <tr>
            <td class="section-stats" bgcolor="#f8f9fa" style="background-color: #f8f9fa; padding: 20px 30px; border-top: 1px solid #e0e0e0;">
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0">
                <tr>
                  <td class="text-meta" style="color: #666666; font-size: 12px; line-height: 1.6;">
                    <p style="margin: 0 0 8px 0; font-weight: bold; color: #003366; font-size: 14px;">
                      Statistik
                    </p>
                    {% if pipeline_stats %}
                    <p style="margin: 0 0 4px 0;">
                      <strong>Pipeline:</strong>
                      {{ pipeline_stats.get('collected', 0) }} gesammelt &rarr;
                      {{ pipeline_stats.get('matched', 0) }} relevant /
                      {{ pipeline_stats.get('rejected', 0) }} abgelehnt &rarr;
                      {{ pipeline_stats.get('duplicates_found', 0) }} Duplikate entfernt
                    </p>
                    {% endif %}
                    <p style="margin: 0;">
                      <strong>Digest:</strong> {{ article_count }} Artikel
                      {% if articles_by_topic %}
                      &nbsp;&bull;&nbsp;
                      {% for topic, topic_articles in articles_by_topic.items() %}
                      {{ topic_translations.get(topic, topic) }}: {{ topic_articles|length }}{% if not loop.last %}, {% endif %}
                      {% endfor %}
                      {% endif %}
                    </p>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- Footer -->
          <tr>
            <td class="section-footer" bgcolor="#f5f5f5" style="background-color: #f5f5f5; padding: 20px 30px; border-radius: 0 0 4px 4px; border-top: 1px solid #e0e0e0;">
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0">
                <tr>
                  <td class="text-meta" style="color: #888888; font-size: 11px; line-height: 1.5;">
                    <p style="margin: 0;">
                      Creditreform Schweiz &bull; NewsAnalysis v{{ version }} &bull; {{ generated_at }}
                    </p>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

        </table>
        <!-- End Main Container -->
      </td>
    </tr>
  </table>
</body>
</html>
